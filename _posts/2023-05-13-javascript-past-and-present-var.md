---
layout: post
title: JavaScript の今昔 var 編
author: Webトレーナー S.Yabu
tags:
  - javascript
  - coding
---

1995 年に JavaScript が登場してから 10 年以上の年月が流れました。  
一時期は差キュリティの観点から使用が制限されたり、 IE に対応するために泣く泣く使うことができない機能があるなどあり、なかなか思うように JavaScript を使えないこともありましたがそれも昔。  
今(2023年5月現在)では ES11 と呼ばれるバージョンになり、モダンなプログラム記述の多くが利用できるまでに至りました。  

しかし、インターネットには古くからの情報が蓄積されており、中には今では推奨されない記述なども残っていたりします。  
というわけで本稿では、今は推奨されない代表的なものを取り上げて、なぜ駄目なのか解説していきます。  

<!--more-->

## 多くのサンプルコードに残る `var`

変数の宣言部で古いサンプルコードでは今でも `var` が使われたままで残っています。  

ES6 以降の JavaScript では、 `let` , `const` を使うことが推奨されます。  
逆に `var` は後方互換で存在こそ残っていますが、新たに使用することは現場のコーダーからはあまり良しとされていません。  

それはなぜなのか。  

大きな理由として `var` で宣言された変数は実行前に処理されてしまうため、宣言前の箇所でもそのまま実行できてしまい思わぬエラーの原因となるからです。  

実際にコード例を見てみましょう。  

```javascript
var x = 3;
function funcA () {
  console.log(`fubnc1: ${x}`);
  var x = 4;
  console.log(`fubnc2: ${x}`);
}
console.log(`1: ${x}`);
funcA();
```

関数 `funcA()` で関数内の変数 `x` の宣言をする前に `x` のコンソール出力を行っています。  
期待した動作は `console.log(``fubnc1: ${x}``);` で 関数の外で定義しているグローバルな `x` の `3` を出力することです。  

ところが実際の実行結果は下記のようになります。  

```text
1: 3
func1: undefined
func2: 4
```

`console.log(``fubnc1: ${x}``);` で `undefined` が出力されてしまいました。  

これは `var` による **巻き取り** と呼ばれる現象で、宣言前の変数が存在する仮定で実行をすることにより、意図しない辛の変数を生み出してしまうことになった例です。  

中級者・上級者になるとなかなか起こりにくいですが、初学者などはうっかりやってしまいがちなバグの典型です。  
これは変数名などをしっかり分けて命名し、区別していれば避けれるのですが、  `x` など仮で使われるような変数がそのまま残ってしまったときに、起こってしまいます。  

ここで `let` や `const` を使っていれば、関数の内外で変数名がかぶっていて判断ができない状態になったときにはエラーとして処理してくれるため、バグの残留を防げます。  

なのでこのサンプルもこうなります。  

```javascript
const globalNum = 3;
function funcA () {
  console.log(`fubnc1: ${globalNum}`);
  const localNum = 4;
  console.log(`fubnc2: ${localNum}`);
}
console.log(`1: ${globalNum}`);
funcA();
```

このようにしっかり変数を命名して分ければグローバルな値とローカルな値、どちらを参照しているのかひと目でわかりますね。  
このように `var` のころに起こっていたような初歩的なバグを発見しやすくなり、コードの可読性も向上させることができます。  

なので新しくコードを書くときは `var` ではなく `let` , `const` を使うことが推奨されます。  

もしサンプルコードなどで `var` があった場合は随時置き換えるようにしましょう。  

置き換えの目安は下記のようになります。  

- `let` : 内容の変更があるものに対して使う
- `const` : 定数やオブジェクト(配列や連想配列、再代入を伴わない HTML Element) などに対して使う

## 統括

今回はざっくり `var` を `let` , `const` に置き換えようという話をしてみました。  
JavaScrip に限らずですが、プログラム言語は常に新しく改善や改修をして進化していっています。  
私たちも、便利で効率がよくなるものは取り入れていきたいですね。  

## 今回の記事に関連した参考文献など

- まとめサイト (モダン JavaScript チートシート)
  - [https://mbeaudru.github.io/modern-js-cheatsheet/translations/ja-JP.html](https://mbeaudru.github.io/modern-js-cheatsheet/translations/ja-JP.html)
- 一冊ですべてさらいたいなら (改訂3版JavaScript本格入門 ～モダンスタイルによる基礎から現場での応用まで)
  - [https://amzn.to/3LYCAJz](https://amzn.to/3LYCAJz)
